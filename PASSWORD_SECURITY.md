# Безопасность паролей

## Обзор

В приложении реализована многоуровневая система защиты паролей для обеспечения максимальной безопасности пользовательских данных.

## Архитектура безопасности

### 1. Хеширование на клиенте
- **Алгоритм**: SHA-256 с солью
- **Соль**: Генерируется на основе временной метки и случайных данных
- **Формат**: `hash:salt` (129 символов)
- **Цель**: Предотвращение передачи паролей в открытом виде по сети

### 2. Хранение на сервере
- **Новые пользователи**: Пароли сохраняются с префиксом `CLIENT_HASH:`
- **Старые пользователи**: Поддерживается обратная совместимость с bcrypt
- **Шифрование токенов**: Jira и AI токены шифруются отдельно

## Реализация

### Клиентская часть (`client/src/utils/passwordHash.ts`)
```typescript
export const hashPassword = (password: string): string => {
  const timestamp = Date.now().toString();
  const randomSalt = CryptoJS.lib.WordArray.random(16).toString();
  const salt = CryptoJS.SHA256(timestamp + randomSalt).toString();
  const hashedPassword = CryptoJS.SHA256(password + salt).toString();
  return `${hashedPassword}:${salt}`;
};
```

### Серверная часть (`server/utils/passwordHash.js`)
```javascript
const verifyClientHashedPassword = async (clientHashedPassword, storedPassword) => {
  // Проверка клиентского хеша
  if (storedPassword.startsWith('CLIENT_HASH:')) {
    const storedClientHash = storedPassword.replace('CLIENT_HASH:', '');
    return storedClientHash === clientHashedPassword;
  }
  // Обратная совместимость с bcrypt
  return false;
};
```

## Преимущества

1. **Безопасность передачи**: Пароли никогда не передаются в открытом виде
2. **Уникальность хешей**: Каждый хеш уникален благодаря соли
3. **Обратная совместимость**: Старые пароли продолжают работать
4. **Защита от атак**: Устойчивость к rainbow table атакам

## Тестирование

Запустите тест безопасности:
```bash
node test_password_security.js
```

## Миграция

Для существующих пользователей:
1. **Автоматическая миграция**: При первом входе система автоматически мигрирует пароль
2. **Процесс миграции**: 
   - Пользователь вводит пароль как обычно
   - Система проверяет старый bcrypt хеш
   - При успешной проверке пароль мигрируется на новую систему
   - Пользователь получает новый JWT токен
3. **Обратная совместимость**: Старые bcrypt хеши поддерживаются до миграции
4. **Безопасность**: Миграция происходит только при успешной аутентификации

## Рекомендации

1. **HTTPS**: Обязательно используйте HTTPS в продакшене
2. **Регулярное обновление**: Периодически обновляйте алгоритмы хеширования
3. **Мониторинг**: Отслеживайте попытки несанкционированного доступа
4. **Резервное копирование**: Регулярно создавайте резервные копии данных

## Безопасность

- ✅ Пароли хешируются на клиенте
- ✅ Уникальная соль для каждого хеша
- ✅ Защита от rainbow table атак
- ✅ Шифрование токенов API
- ✅ Обратная совместимость
- ✅ Валидация на сервере
